<!DOCTYPE html5>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注册页面</title>
    <link rel="stylesheet" href="lib/bootstrap-3.4.1/css/bootstrap.css">
    <link rel="shortcut icon" href="img/bitbug_favicon.ico" type="image/x-icon">
    <style>
        body {
            background-image: url(img/12.png);
            background-size: cover;
        }
        
        .main {
            width: 800px;
            height: 480px;
            margin: 50px auto;
            padding-top: 5px;
            border: 1px solid #444;
        }
        
        .help-block {
            padding: 0 !important;
        }
        
        h2 {
            color: black;
            margin-bottom: 20px;
        }
        
        #getYzm {
            position: absolute;
            top: -4px;
            padding: 5px 0;
            width: 90px;
            height: 32px;
            text-align: center;
            border: 1px solid #ccc;
            color: blue;
            background-color: rgb(204, 204, 204, .5);
            display: none;
            cursor: default;
        }
        
        .has-success .control-label {
            color: rgb(4, 192, 98) !important;
        }
        
        .has-success .form-control {
            border-color: rgb(4, 192, 98) !important;
        }
        
        .error {
            color: red;
        }
    </style>
</head>

<body>
    <div class="main">
        <h2 class="text-center">注册账号</h2>
        <form class="form-horizontal" method="post" enctype="multipart/form-data" action="javascript:;">
            <div class="form-group">
                <label for="inputText3" class="col-xs-offset-1 col-xs-2 control-label">用户名:</label>
                <div class="col-xs-5">
                    <input type="text" class="form-control" pattern='^[a-zA-Z0-9_]{5,16}$' id="inputText3" name="user_name" placeholder="请输入用户名" required>
                </div>
                <div class="col-xs-4 help-block">请输入5-16位(字母、数字、_)</div>
            </div>
            <div class="form-group">
                <label for="inputPassword3" class="col-xs-offset-1 col-xs-2 control-label ">密&emsp;码:</label>
                <div class="col-xs-5">
                    <input type="password" class="form-control " pattern="^[a-zA-Z0-9_]{5,16}$" name="user_psw" id="inputPassword3" placeholder="请输入密码" required>
                </div>
                <div class="col-xs-4 help-block">请输入5-16位(字母、数字、_)</div>
            </div>
            <div class="form-group">
                <label for="inputPassword3" class="col-xs-offset-1 col-xs-2 control-label ">手机号:</label>
                <div class="col-xs-5">
                    <input type="tel" class="form-control" pattern="^1[3,5,6,7,8,9]\d{9}$" id="inputTel3" name="user_tel" placeholder="请输入手机号" required>
                </div>
                <div class="col-xs-3 help-block">
                    <input type="button" disabled id="setYzm" value="点击获取验证码" />
                </div>
            </div>
            <div class="form-group">
                <label for="inputPassword3" class="col-xs-offset-1 col-xs-2 control-label ">验证码:</label>
                <div class="col-xs-3">
                    <input type="text" class="form-control " pattern="^[a-zA-Z0-9_]{6}$" maxlength="6" id="inputYzm" required>
                </div>
                <div class="col-xs-2 help-block">
                    <em id="getYzm"></em>
                </div>
            </div>
            <div class="form-group">
                <div class="col-xs-offset-3 col-xs-5">
                    <div class="radio">
                        <label>
                    <input type="radio" checked  name="power" value="普通成员">普通成员
                  </label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="col-xs-offset-3 col-xs-5">
                    <div class="checkbox">
                        <label>
                    <input type="checkbox" required  name="place" value="/sign"> 我已阅读并同意<a href="javascript:;">此协议</a>
                  </label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="col-xs-offset-3 col-xs-5">
                    <button id="submit" type="submit" class="btn btn-info">注&emsp;册</button>&nbsp; 已有账号？
                    <a href="/api/login">去登录</a>
                </div>
            </div>
        </form>
    </div>
    <script src="lib/jQuery-1.12.4/jQuery-1.12.4-min.js"></script>
    <script src="lib/bootstrap-3.4.1/js/bootstrap.js"></script>
    <script>
        let userName = new RegExp(/^\w{5,16}$/);
        let userTel = new RegExp(/^1[3,5,6,7,8,9]\d{9}$/);
        let userYzm = /^\w{6}$/i;
        let arr = [];
        for (let i = 0; i <= 9; i++) {
            arr.push(i);
        }
        for (let i = 97; i <= 122; i++) {
            arr.push(String.fromCharCode(i));
        }
        for (let i = 65; i <= 90; i++) {
            arr.push(String.fromCharCode(i));
        }
        // 用户名密码验证
        $('#inputText3,#inputPassword3 ').blur(function() {
            if (!userName.test($(this).val().trim())) {
                $(this).parents('.form-group ').addClass('has-error ').removeClass('has-success');
            } else {
                $(this).parents('.form-group ').removeClass('has-error ').addClass('has-success ');
            }
        });

        // 手机号验证
        $('#inputTel3 ').blur(function() {
            if (!userTel.test($(this).val().trim())) {
                $(this).parents('.form-group ').addClass('has-error ').removeClass('has-success');
            } else {
                $(this).parents('.form-group ').removeClass('has-error ').addClass('has-success ');
                $('#setYzm ').removeAttr('disabled ');
            }
        });
        // 验证码
        $('#setYzm ').click(function() {
            // 为验证码赋值并显示
            let str = ' ';
            for (var i = 0; i < 6; i++) {
                let t = Math.round(Math.random() * 61);
                str += arr[t];
            }
            $('#getYzm ').text(str);
            $('#getYzm ').show();
            // 设置获取验证码按钮
            let num = 30;
            $('#setYzm').attr('disabled', 'true');
            $('#setYzm').val(`${num}秒后重新获取`);
            this.time = setInterval(() => {
                num--;
                if (num == 0) {
                    $(this).removeAttr('disabled ');
                    $(this).val('点击获取验证码 ');
                    clearInterval(this.time);
                } else {
                    $(this).val(`${num}秒后重新获取`);
                }
            }, 1000);
            // 验证码验证
            $('#inputYzm').blur(function() {
                let res = str.trim().toLowerCase() == $(this).val().trim().toString().toLowerCase();
                if ((!userYzm.test($(this).val().trim()) || !res)) {
                    $(this).parents('.form-group ').addClass('has-error ').removeClass('has-success');
                } else {
                    $(this).parents('.form-group').removeClass('has-error ').addClass('has-success ');
                }
            });
        });
        // 注册按钮
        $('#submit ').click(function() {
            if ($('#inputYzm').parents('.form-group ').attr('class').includes('has-success')) {
                $('form').attr('action', '/api/doSign');
            }
        })
    </script>
</body>

</html>